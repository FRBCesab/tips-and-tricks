{
  "hash": "7af30679fe38e2a0cd52d5734819e5fe",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Research compendium\"\nauthor: \"Nicolas Casajus\"\ndate: \"2024-09-24\"\ncategories: [r, compendium, project, description-file, reproducibility, documentation]\nimage: \"\"\ntoc: true\ndraft: false\nlightbox: true\ncode-overflow: scroll\n---\n\n\nThis post explains how to work with a **research compendium**. The goal of a research compendium is to provide a standard and easily recognizable way for **_organizing the digital materials_** of a project to enable others to inspect, reproduce, and extend the research (Marwick B _et al._ 2018). A research compendium follows three general principles:\n\n- Files are **organized** according to the conventions of the community\n- Data, method, and output are clearly **separated**\n- **Computational environment** that was used is specified\n\n> In other words, a research compendium is a simple way to organize files by separating the data, the code, and the results, while also documenting the computational environment.\n\n<br/>\n\n::: {.small}\n{{< fa hand-point-right >}}&nbsp; This post is derived from the [exercise](https://rdatatoolbox.github.io/chapters/ex-compendium.html) proposed as part of the training course [Reproducible Research in Computational Ecology](https://rdatatoolbox.github.io/).\n:::\n\n<br/>\n\n## Foreward\n\nIn order to assist us in creating the structure of our working directory, we will use the {{< fa brands r-project >}} [`rcompendium`](https://github.com/frbcesab/rcompendium) package, developed by the author of this post. This package allows for the automation of creating files and directories specific to a research compendium (and a {{< fa brands r-project >}} package).\n\nThe package is released on the [CRAN](https://cran.r-project.org/web/packages/rcompendium/index.html) but we will install the development version from [GitHub](https://github.com/frbcesab/rcompendium):\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Install 'remotes' package ----\ninstall.packages(\"remotes\")\n\n## Install 'rcompendium' package from GitHub ----\nremotes::install_github(\"frbcesab/rcompendium\")\n\n## Attach 'rcompendium' package -----\nlibrary(\"rcompendium\")\n```\n:::\n\n\n{{< fa lightbulb >}}&nbsp; If you encounter difficulties installing the package, please carefully read the **Installation** section of the [README](https://github.com/frbcesab/rcompendium?tab=readme-ov-file#installation).\n\nOnce the package is installed, you need to run the [`set_credentials()`](https://frbcesab.github.io/rcompendium/reference/set_credentials.html) function to store your personal information locally (first name, last name, email, ORCID, communication protocol with GitHub). This information will automatically populate certain files in the compendium. **This function should only be used once**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Store personal information ----\nset_credentials(given    = \"Jane\",\n                family   = \"Doe\", \n                email    = \"jane.doe@mail.me\", \n                orcid    = \"0000-0000-0000-0000\", \n                protocol = \"ssh\")\n```\n:::\n\n\nThis information has been copied to the clipboard. Paste its content into the file `~/.Rprofile` (opened in RStudio using this function). This file is read every time {{< fa brands r-project >}} is opened, and its content will be accessible to the [`rcompendium`](https://github.com/frbcesab/rcompendium) package.\n\nRestart the {{< fa brands r-project >}} session (**_Session > Restart R_**) and verify that your personal information is correctly accessible.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Retrieve email ----\ngetOption(\"email\")\n# [1] \"jane.doe@mail.me\"\n\n## Retrieve family name ----\ngetOption(\"family\")\n# [1] \"Doe\"\n```\n:::\n\n\n\n<br/>\n\n## RStudio project\n\nWhen you start a new project in {{< fa brands r-project >}} it is [strongly recommended](https://support.posit.co/hc/en-us/articles/200526207-Using-RStudio-Projects) to use **RStudio Projects**.\n\n{{< fa hand-point-right >}}&nbsp; Create a new RStudio Project: **_File > New Project > New Directory > New Project_** and proceed as follow:\n\n- choose a name for your project (short and without whitespace)\n- select the location where the new project will be created\n- uncheck all other boxes\n- confirm\n\n![](rstudio-project.png){fig-align='center' width=50%}\n\n\n::: {.callout-tip}\n## Good practice #1\n\nAlways work within an **RStudio project**. This has the advantage of simplifying file paths, especially with the [`here`](https://here.r-lib.org/) package and its [`here()`](https://here.r-lib.org/reference/here.html) function. The paths will always be constructed relative to the folder containing the `.Rproj` file (the project root). This is called a **_relative path_**.\n\n{{< fa hand-point-right >}}&nbsp; **Never use** the [`setwd()`](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/getwd) function again.\n:::\n\n\n::: {.callout-note}\n## To go further\n\nIf you share your project on a cloud-based git repository (e.g. [GitHub](https://github.com), [GitLab](https://github.com), etc.) to collaborate, we recommend to add the `.Rproj` file to the `.gitignore`. The content of this `.Rproj` file can change between RStudio versions leading to unnecessary `git` conflicts. Listing the `.Rproj` file in the `.gitignore` will ensure that each user is working locally with its own version of this file.\n:::\n\n\n::: {.small}\n{{< fa folder >}}&nbsp; **Research compendium at this stage**\n\n```\npractice/                        # Root of the compendium\n|\n└─ practice.Rproj                # RStudio project file\n```\n:::\n\n<br/>\n\n\n## README\n\nEvery project must contain a **README** file. It is the **showcase of the project**. The roles of a **README** are multiple:\n\n- Describe the project\n- Explain its contents\n- Explain how to install it\n- Explain how to use it\n\nIt is a simple text file (_plain text-based file_) that can be written in plain text (`README.txt`), in simple Markdown (`README.md`), in R Markdown (`README.Rmd`), in Quarto (`README.qmd`), etc.\n\n{{< fa hand-point-right >}}&nbsp; Here, you will create a `README.md` (simple [**Markdown**](https://docs.github.com/en/get-started/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax)) at the root of your project.\n\n{{< fa lightbulb >}}&nbsp; Use the [`utils::file.edit()`](https://rdrr.io/r/utils/file.edit.html) function, which allows you to open a file in the RStudio editor. If the file doesn't exist, it will also create it.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Add a README ----\nutils::file.edit(here::here(\"README.md\"))\n```\n:::\n\n\n\n{{< fa hand-point-right >}}&nbsp; Run this line of code in the console: `here::here(\"README.md\")` and try to understand what the [`here::here()`](https://here.r-lib.org/reference/here.html) function does.\n\n{{< fa hand-point-right >}}&nbsp; Edit this `README.md` by adding the information that you find relevant.\n\n**Suggestion** &nbsp;{{< fa caret-down >}}\n\n::: {.small}\n\n\n::: {.cell}\n\n```{.txt .cell-code  code-fold=\"false\"}\n# Practice\n\nThis project contains files to create a simple **research compendium** as \npresented in the training course \n[Reproducible Research in Computational Ecology](https://rdatatoolbox.github.io).\n\n\n## Content\n\nThis project is structured as follow:\n\n- `README.md`: presentation of the project\n- `practice.Rproj`: RStudio project file\n\n\n## Installation\n\nComing soon...\n\n\n## Usage\n\nComing soon...\n\n\n## Citation\n\n> Doe J (2024) Minimal structure of a research compendium.\n```\n:::\n\n\n:::\n\n\n::: {.callout-tip}\n## Good practice #2\n\nAlways add a **README** to help the user understand your project. If you want to execute {{< fa brands r-project >}} code inside, write it in [**R Markdown**](https://rmarkdown.rstudio.com/) (`README.Rmd`) or [**Quarto**](https://quarto.org/) (`README.qmd`), otherwise, simply use [**basic Markdown**](https://docs.github.com/en/get-started/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax) (`README.md`).\n\n**NB.** If you write a `.Rmd` or `.qmd`, don't forget to convert it into a `.md` file. GitHub can only interpret basic Markdown.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Convert .Rmd in .md ----\nrmarkdown::render(\"README.Rmd\")\n\n## Convert .qmd in .md ----\nquarto::quarto_render(\"README.qmd\")\n```\n:::\n\n\n{{< fa lightbulb >}}&nbsp; You can also click on the **_Render_** button of RStudio.\n:::\n\n\n::: {.callout-note}\n## The [`rcompendium::add_readme_rmd()`](https://frbcesab.github.io/rcompendium/reference/add_readme_rmd.html) function\n\nYou can use the [`add_readme_rmd()`](https://frbcesab.github.io/rcompendium/reference/add_readme_rmd.html) function of [`rcompendium`](https://github.com/frbcesab/rcompendium) package that populates a **README** template for {{< fa brands r-project >}} projects.\n:::\n\n\n::: {.small}\n{{< fa folder >}}&nbsp; **Research compendium at this stage**\n\n```\npractice/                        # Root of the compendium\n|\n├─ practice.Rproj                # RStudio project file\n|\n└─ README.md                     # Presentation of the project\n```\n:::\n\n\n<br/>\n\n\n## DESCRIPTION\n\nThe **DESCRIPTION** file describes the metadata of the project (title, author, description, dependencies, etc.). It is one of the essential elements of a {{< fa brands r-project >}} package. Here, we will repurpose it for use in a research compendium in order to take advantage of package development tools (see below).\n\n{{< fa hand-point-right >}}&nbsp; Add a **DESCRIPTION** file using the [`add_description()`](https://frbcesab.github.io/rcompendium/reference/add_description.html) function of the [`rcompendium`](https://github.com/frbcesab/rcompendium) package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Add a DESCRIPTION file ----\nrcompendium::add_description()\n```\n:::\n\n\n::: {.small}\n\n```\nPackage: practice\nType: Package\nTitle: The Title of the Project\nVersion: 0.0.0.9000\nAuthors@R: c(\n    person(given   = \"Jane\",\n           family  = \"Doe\",\n           role    = c(\"aut\", \"cre\", \"cph\"),\n           email   = \"jane.doe@mail.me\",\n           comment = c(ORCID = \"0000-0000-0000-0000\")))\nDescription: A paragraph providing a full description of the project (on \n    several lines...)\nLicense: {{license}}\nEncoding: UTF-8\n```\n:::\n\nAs you can see, the **DESCRIPTION** file has been pre-filled with your personal information. You will edit the **_Title_** and **_Description_** fields later.\n\n\n::: {.callout-tip}\n## Good practice #3\n\nAlways add a **DESCRIPTION** file at the root of the project. It is used to describe the **project's metadata**: title, author(s), description, license, etc. We will discuss this later, but it is also the ideal place to **list required external packages**.\n:::\n\n\n\n::: {.small}\n{{< fa folder >}}&nbsp; **Research compendium at this stage**\n\n```\npractice/                        # Root of the compendium\n|\n├─ practice.Rproj                # RStudio project file\n|\n├─ README.md                     # Presentation of the project\n└─ DESCRIPTION                   # Project metadata\n```\n:::\n\n\n<br/>\n\n\n## LICENSE\n\nAny material shared online must have a **LICENSE** that describes what can be done with it. Therefore, we recommend adding a license to your project **from the start**. To determine which license is most appropriate for your project, you can visit this website: <https://choosealicense.com>.\n\n{{< fa hand-point-right >}}&nbsp; Add the [GPL-3](https://choosealicense.com/licenses/gpl-3.0/) license to your project using the [`add_license()`](https://frbcesab.github.io/rcompendium/reference/add_license.html) function of the [`rcompendium`](https://github.com/frbcesab/rcompendium) package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Add a license ----\nadd_license(license = \"GPL-3\")\n```\n:::\n\n\nNote that a new file has been created: `LICENSE.md`. This file details the contents of the license and will be read by GitHub. Also, check the content of the **DESCRIPTION** file: the **_License_** section has been updated thanks to [`rcompendium`](https://github.com/frbcesab/rcompendium).\n\n{{< fa hand-point-right >}}&nbsp; Add a section in the `README.md` mentioning the license.\n\n**Suggestion** &nbsp;{{< fa caret-down >}}\n\n::: {.small}\n\n\n::: {.cell}\n\n```{.txt .cell-code  code-fold=\"false\"}\n# Practice\n\nThis project contains files to create a simple **research compendium** as \npresented in the training course \n[Reproducible Research in Computational Ecology](https://rdatatoolbox.github.io).\n\n\n## Content\n\nThis project is structured as follow:\n\n- `README.md`: presentation of the project\n- `DESCRIPTION`: project metadata\n- `LICENSE.md`: license of the project\n- `practice.Rproj`: RStudio project file\n\n\n## Installation\n\nComing soon...\n\n\n## Usage\n\nComing soon...\n\n\n## License\n\nThis project is released under the \n[GPL-3](https://choosealicense.com/licenses/gpl-3.0/) license.\n\n\n## Citation\n\n> Doe J (2024) Minimal structure of a research compendium.\n```\n:::\n\n:::\n\n\n::: {.callout-tip}\n## Good practice #4\n\nAlways add a **LICENSE** to a project that will be made public. Visit the [Choose a License](https://choosealicense.com/appendix/) website to select the most appropriate one for your project.\n\n**Note:** If no license is provided, your project will be subject to the [No License](https://choosealicense.com/no-permission/) rules: no permissions are granted. In other words, no one can do anything with your project (no reuse, no modification, no sharing, etc.).\n:::\n\n\n\n::: {.small}\n{{< fa folder >}}&nbsp; **Research compendium at this stage**\n\n```\npractice/                        # Root of the compendium\n|\n├─ practice.Rproj                # RStudio project file\n|\n├─ README.md                     # Presentation of the project\n├─ DESCRIPTION                   # Project metadata\n└─ LICENSE.md                    # License of the project\n```\n:::\n\n\n<br/>\n\n## Subdirectories\n\nThe next step involves creating **subdirectories**, each with a specific role. The idea here is to separate the data, results, and code.\n\n\n{{< fa hand-point-right >}}&nbsp; To do this, use the [`add_compendium()`](https://frbcesab.github.io/rcompendium/reference/add_compendium.html) function from [`rcompendium`](https://github.com/frbcesab/rcompendium).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Create subdirectories ----\nrcompendium::add_compendium()\n```\n:::\n\n\n::: {.callout-tip}\n## Good practice #5\n\nA good Research compendium will consist of **different subdirectories**, each intended to hold a specific type of file. By default, the [`add_compendium()`](https://frbcesab.github.io/rcompendium/reference/add_compendium.html) function will create this organization:\n\n- The `data/` folder will contain all the raw data necessary for the project.\n- The `outputs/` folder will contain all the generated results (excluding figures).\n- The `figures/` folder will contain all the figures produced by the analyses.\n- The `R/` folder will only contain {{< fa brands r-project >}} functions (and their documentation). See below for more details.\n- The `analyses/` folder will contain {{< fa brands r-project >}} scripts (or `.Rmd` and/or `.qmd` files) that will call the functions.\n\n**Note:** This structure can of course be adapted based on needs, personal practices, and the complexity of the project. With the exception of the **`R/`** folder, all other directories can be named differently.\n:::\n\n\n::: {.small}\n{{< fa folder >}}&nbsp; **Research compendium at this stage**\n\n```\npractice/                        # Root of the compendium\n|\n├─ practice.Rproj                # RStudio project file\n|\n├─ README.md                     # Presentation of the project\n├─ DESCRIPTION                   # Project metadata\n├─ LICENSE.md                    # License of the project\n|\n├─ data/                         # Contains raw data\n├─ outputs/                      # Contains results\n├─ figures/                      # Contains figures\n├─ R/                            # Contains R functions (only)\n└─ analyses/                     # Contains R scripts\n```\n:::\n\n\n<br/>\n\n\n## Writing code\n\nWe're ready to code!\n\n> Here we will write a code that will download the [PanTHERIA](https://doi.org/10.1890/08-1494.1) dataset (Jones et al. 2009) and save it locally in our compendium.\n\n**PanTHERIA** is a species-level database of life history, ecology, and geography of extant and recently extinct mammals. Metadata can be found [here](https://esapubs.org/archive/ecol/E090/184/metadata.htm). Note that missing values are coded `-999`.\n\nWe'll start by writing our code in a {{< fa brands r-project >}} **script**. The PanTHERIA data file, available [here](https://esapubs.org/archive/ecol/E090/184/PanTHERIA_1-0_WR05_Aug2008.txt), will be saved in the **data/pantheria/** subdirectory. \n\n\n{{< fa hand-point-right >}}&nbsp; Create the `download-data.R` script in the **analyses/** directory using the [`utils::file.edit()`](https://rdrr.io/r/utils/file.edit.html) function.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Create a R script in the directory analyses/ ----\nutils::file.edit(here::here(\"analyses\", \"download-data.R\"))\n```\n:::\n\n\n{{< fa hand-point-right >}}&nbsp; Now write the code to download the data file.\n\n{{< fa lightbulb >}}&nbsp; Use [`dir.create()`](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/files2) to create the subdirectory **data/pantheria/**, [`here::here()`](https://here.r-lib.org/reference/here.html) to build robust paths and [`utils::download.file()`](https://www.rdocumentation.org/packages/utils/versions/3.6.2/topics/download.file) to download the file from the URL.\n\n\n**Suggestion** &nbsp;{{< fa caret-down >}}\n\n::: {.small}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# Download PanTHERIA dataset\n#\n# Author: Jane Doe\n# Date: 2024/09/24\n\n## Destination path ---- \npath <- here::here(\"data\", \"pantheria\")\n\n## Create destination directory ----\ndir.create(path, showWarnings = FALSE, recursive = TRUE)\n\n## File name ----\nfilename <- \"PanTHERIA_1-0_WR05_Aug2008.txt\"\n  \n## Repo base URL ----\nbase_url <- \"https://esapubs.org/archive/ecol/E090/184/\"\n\n## Build full URL ----\nfull_url <- paste0(base_url, filename)\n\n## Build full path ----\ndest_file <- file.path(path, filename)\n\n## Download file ----\nutils::download.file(url      = full_url,\n                     destfile = dest_file,\n                     mode     = \"wb\")\n```\n:::\n\n:::\n\n\n::: {.callout-tip}\n## Good practice #6\n\nTry **scripting the whole project** (including data acquisition). Here, we've seen how to create files ([`utils::file.edit()`](https://rdrr.io/r/utils/file.edit.html)) and directories ([`dir.create()`](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/files2)), build robust relative paths ([`here::here()`](https://here.r-lib.org/reference/here.html)) and download files ([`utils::download.file()`](https://www.rdocumentation.org/packages/utils/versions/3.6.2/topics/download.file)) directly from {{< fa brands r-project >}}.\n:::\n\n\n::: {.callout-note}\n## External packages\n\nTo use a function from an external package, you've learned to use `library(pkg)`. In {{< fa brands r-project >}}, there's another syntax for calling a function from an external package: `pkg::fun()`. Whereas `library()` **loads and attaches** a package (making its functions directly accessible with `fun()`), the syntax `pkg::fun()` **only loads** a package in the session, but does not attach its contents. This means you have to specify the package name when calling the function.\n\nWe recommend using the `pkg::fun()` syntax. There are two reasons for this:\n\n- **A better code readability**: at a glance, you'll know which package the function is in.\n- **Limits conflicts between packages**: two functions can have the same name in two different packages. For example, the `dplyr` package offers a `filter()` function which is also found in the `stats` package (attached to the opening of {{< fa brands r-project >}}). However, the `filter()` functions in these two packages do not do the same thing.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"dplyr\")\n\n## Attaching package: ‘dplyr’\n## \n## The following objects are masked from ‘package:stats’:\n## \n##     filter, lag\n## \n## The following objects are masked from ‘package:base’:\n## \n##     intersect, setdiff, setequal, union\n```\n:::\n\n\nIf you use `library(dplyr)`, you'll never be 100% sure whether you're using the `filter()` function of the `dplyr` package or that of the `stats` package.\n\nHowever, for very verbose packages (such as `ggplot2`), you can use the `library()` function, otherwise your code will quickly become tedious to write.\n\n{{< fa lightbulb >}}&nbsp; If you wish to use the `%>%` pipe, attach the `magrittr` package with `library(magrittr)`.\n:::\n\n\n::: {.small}\n{{< fa folder >}}&nbsp; **Research compendium at this stage**\n\n```\npractice/                                   # Root of the compendium\n|\n├─ practice.Rproj                           # RStudio project file\n|\n├─ README.md                                # Presentation of the project\n├─ DESCRIPTION                              # Project metadata\n├─ LICENSE.md                               # License of the project\n|\n├─ data/                                    # Contains raw data\n|  └─ pantheria/                            # PanTHERIA database\n|     └─ PanTHERIA_1-0_WR05_Aug2008.txt\n|\n├─ outputs/                                 # Contains results\n├─ figures/                                 # Contains figures\n├─ R/                                       # Contains R functions (only)\n|\n└─ analyses/                                # Contains R scripts\n   └─ download-data.R                       # Script to download raw data\n```\n:::\n\n\n\n\n<br/>\n\n## Code refactoring\n\nWe can take this a step further by converting the script into **function**: this is known as **code refactoring**. A [**function**](https://r4ds.hadley.nz/functions.html) is a set of lines of code grouped together in a single block to perform a specific task. Writing functions will make your code **clearer** and more easily **reusable** between projects.\n\n\n::: {.callout-important}\n## Convention\n\nAlways store your {{< fa brands r-project >}} **functions** (and only functions) in a directory named **`R/`** located at the **root of the project**.\n:::\n\n\n{{< fa hand-point-right >}}&nbsp; Convert the previous {{< fa brands r-project >}} code into a function named `dl_pantheria_data()`.\n\n{{< fa lightbulb >}}&nbsp; Use the [`usethis::use_r()`](https://usethis.r-lib.org/reference/use_r.html) function to create the function file inside the **R/** directory.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Create the function file in R/ ----\nusethis::use_r(\"dl_pantheria_data\")\n```\n:::\n\n\n**Suggestion** &nbsp;{{< fa caret-down >}}\n\n::: {.small}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\ndl_pantheria_data <- function() {\n  \n  ## Destination path ---- \n  path <- here::here(\"data\", \"pantheria\")\n  \n  ## Create destination directory ----\n  dir.create(path, showWarnings = FALSE, recursive = TRUE)\n  \n  ## File name ----\n  filename <- \"PanTHERIA_1-0_WR05_Aug2008.txt\"\n    \n  ## Repo base URL ----\n  url <- \"https://esapubs.org/archive/ecol/E090/184/\"\n  \n  ## Build full URL ----\n  full_url <- paste0(base_url, filename)\n  \n  ## Build full path ----\n  dest_file <- file.path(path, filename)\n\n  ## Download file ----\n  utils::download.file(url      = full_url,\n                       destfile = dest_file,\n                       mode     = \"wb\")\n  \n  return(dest_file)\n}\n```\n:::\n\n:::\n\n\n\n::: {.callout-tip}\n## Good practice #7\n\n**Write functions**: this is called _code refactoring_. This will make your **code clearer** and **easier to reuse**. Always store your {{< fa brands r-project >}} functions in the **R/** folder. If you're using functions from external packages, write them as follows: `pkg::fun()`.\n:::\n\n\n{{< fa hand-point-right >}}&nbsp; Finally adapt the content of the `analyses/download-data.R` {{< fa brands r-project >}} script created earlier so that it calls the `dl_pantheria_data()` function.\n\n\n**Suggestion** &nbsp;{{< fa caret-down >}}\n\n::: {.small}\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# Download project raw data\n#\n# This script will download the PanTHERIA dataset and will store it in `data/`\n# by calling the dl_pantheria_data() function available in the `R/` directory.\n#\n# Author: Jane Doe\n# Date: 2024/09/24\n\n## Download PanTHERIA dataset ----\npantheria_path  <- dl_pantheria_data()\n```\n:::\n\n:::\n\n\n::: {.callout-tip}\n## Good practice #8\n\nThe **analyses/** directory contains {{< fa brands r-project >}} scripts that call {{< fa brands r-project >}} functions stored in the **R/** folder. In the case of complex analyses, don't hesitate to multiply the scripts (rather than having a single large script).\n\n```{mermaid}\n%%{init:{'theme':'neutral','flowchart':{'htmlLabels':false}}}%%\nflowchart LR\n  B(\"analyses/download-data.R\")\n  B --> C(\"dl_pantheria_data()\")\n```\n\n:::\n\n\n\n::: {.small}\n{{< fa folder >}}&nbsp; **Research compendium at this stage**\n\n```\npractice/                                   # Root of the compendium\n|\n├─ practice.Rproj                           # RStudio project file\n|\n├─ README.md                                # Presentation of the project\n├─ DESCRIPTION                              # Project metadata\n├─ LICENSE.md                               # License of the project\n|\n├─ data/                                    # Contains raw data\n|  └─ pantheria/                            # PanTHERIA database\n|     └─ PanTHERIA_1-0_WR05_Aug2008.txt\n|\n├─ outputs/                                 # Contains results\n├─ figures/                                 # Contains figures\n|\n├─ R/                                       # Contains R functions (only)\n|  └─ dl_pantheria_data.R                   # Function to download PanTHERIA data\n|\n└─ analyses/                                # Contains R scripts\n   └─ download-data.R                       # Script to download raw data\n```\n:::\n\n\n<br/>\n\n## Documentation\n\nIt's time to **document** your function. **It's essential!** To do this, we're going to use the [`roxygen2`](https://roxygen2.r-lib.org/articles/roxygen2.html) syntax. This makes it easy to document functions by placing a **special header before the function**. This header must contain (as a minimum) a title, a description of each argument and the function's return.\n\n{{< fa hand-point-right >}}&nbsp; Add a [`roxygen2`](https://roxygen2.r-lib.org/articles/roxygen2.html) header to your function to document it.\n\n\n**Suggestion** &nbsp;{{< fa caret-down >}}\n\n::: {.small}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n#' Download PanTHERIA dataset\n#'\n#' @description \n#' This function downloads the PanTHERIA dataset (text file) available at\n#' <https://esapubs.org/archive/ecol/E090/184/PanTHERIA_1-0_WR05_Aug2008.txt>.\n#' \n#' The file `PanTHERIA_1-0_WR05_Aug2008.txt` will be stored in \n#' `data/pantheria/`. Note that this folder will be created if required.\n#'\n#' @return This function returns the path (`character`) to the downloaded file\n#' (e.g. `data/pantheria/PanTHERIA_1-0_WR05_Aug2008.txt`).\n\ndl_pantheria_data <- function() { ... }\n```\n:::\n\n:::\n\n\n{{< fa lightbulb >}}&nbsp; Our function does not contain any parameter. But if this were the case, we would have had to describe the parameters with the [`roxygen2`](https://roxygen2.r-lib.org/articles/roxygen2.html) tag `#' @param`.\n\n\n::: {.callout-tip}\n## Good practice #9\n\nThink of others (and of your future self)! **Always document** your code. Code without documentation is useless. Use **roxygen2** headers to document your {{< fa brands r-project >}} functions, simple comments to document code and `README` for everything else.\n:::\n\n\n::: {.callout-note}\n## To go further\n\nYou can convert your **roxygen2** headers into `.Rd` files, the only files accepted by {{< fa brands r-project >}} for documenting functions. These `.Rd` files will be stored in the **man/** folder. This is not mandatory when working with a research compendium but this is required if you develop a {{< fa brands r-project >}} package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Generate function documentation (.Rd files) ----\ndevtools::document()\n```\n:::\n\n\nHelp for your function will be available via `?fun_name`.\n:::\n\n\n::: {.small}\n{{< fa folder >}}&nbsp; **Research compendium at this stage** (same as before)\n\n```\npractice/                                   # Root of the compendium\n|\n├─ practice.Rproj                           # RStudio project file\n|\n├─ README.md                                # Presentation of the project\n├─ DESCRIPTION                              # Project metadata\n├─ LICENSE.md                               # License of the project\n|\n├─ data/                                    # Contains raw data\n|  └─ pantheria/                            # PanTHERIA database\n|     └─ PanTHERIA_1-0_WR05_Aug2008.txt\n|\n├─ outputs/                                 # Contains results\n├─ figures/                                 # Contains figures\n|\n├─ R/                                       # Contains R functions (only)\n|  └─ dl_pantheria_data.R                   # Function to download PanTHERIA data\n|\n└─ analyses/                                # Contains R scripts\n   └─ download-data.R                       # Script to download raw data\n```\n:::\n\n\n<br/>\n\n\n\n## Dependencies\n\nOur project depends on two external packages: [`utils`](https://www.rdocumentation.org/packages/utils/versions/3.6.2) and [`here`](https://here.r-lib.org/). As mentioned previously, the **DESCRIPTION** file is the ideal place to centralize the list of **required packages**.\n\n\n{{< fa hand-point-right >}}&nbsp; Add these two dependencies to the DESCRIPTION file with the [`usethis::use_package()`](https://usethis.r-lib.org/reference/use_package.html) function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Add dependencies in DESCRIPTION ----\nusethis::use_package(package = \"here\")\nusethis::use_package(package = \"utils\")\n```\n:::\n\n\nLook at the contents of the **DESCRIPTION** file: the two required packages are listed in the **_Imports_** section.\n\n\n\n::: {.small}\n\n```\nPackage: practice\nType: Package\nTitle: The Title of the Project\nVersion: 0.0.0.9000\nAuthors@R: c(\n    person(given   = \"Jane\",\n           family  = \"Doe\",\n           role    = c(\"aut\", \"cre\", \"cph\"),\n           email   = \"jane.doe@mail.me\",\n           comment = c(ORCID = \"0000-0000-0000-0000\")))\nDescription: A paragraph providing a full description of the project (on \n    several lines...)\nLicense: GPL-3\nEncoding: UTF-8\nImports:\n    here,\n    utils\n```\n:::\n\n\n::: {.callout-tip}\n## Good practice #10\n\nAlways list the **required packages in the DESCRIPTION** file. In this way, you will centralize the list of required packages in one place and use the [`devtools::install_deps()`](https://remotes.r-lib.org/reference/install_deps.html) and [`devtools::load_all()`](https://www.rdocumentation.org/packages/devtools/versions/2.4.5/topics/load_all) functions (see section [Loading the project](#loading-the-project)).\n:::\n\n\n::: {.callout-note}\n## To go further\n\nIf in your {{< fa brands r-project >}} code you want to attach your packages with `library()`, use the [`usethis::use_package()`](https://usethis.r-lib.org/reference/use_package.html) function as follows: \n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Create a strong dependency ----\nusethis::use_package(package = \"ggplot2\", type = \"Depends\")\n```\n:::\n\n\nThe package will be added to the **_Depends_** section of the **DESCRIPTION** file.\n:::\n\n\n<br/>\n\n\n\n## Loading the project\n\nNow that our compendium contains a **DESCRIPTION** file with a list of packages, we can use the package development tools {{< fa brands r-project >}} available in the package [`devtools`](https://devtools.r-lib.org/) to:\n\n**1) Install packages** with the [`devtools::install_deps()`](https://devtools.r-lib.org/reference/install_deps.html) function\n\nThis function reads the **DESCRIPTION** file to retrieve packages listed in the **_Depends_** and **_Imports_** sections and install them (only if they are not already installed). This function therefore replaces the [`install.packages()`](https://www.rdocumentation.org/packages/utils/versions/3.6.2/topics/install.packages) function.\n\n{{< fa lightbulb >}}&nbsp; By default, this function will also ask you to update packages (if a new version is available). If you wish to disable this feature, add the argument `upgrade = \"never\"`. \n\n\n**2) Load packages** with the [`devtools::load_all()`](https://www.rdocumentation.org/packages/devtools/versions/2.4.5/topics/load_all) function\n\nThis function will read the **DESCRIPTION** file to retrieve packages listed in the **_Depends_** and **_Imports_** sections. It will **load** the packages listed in the **_Imports_** section and **load and attach** the packages listed in the **_Depends_** section.\nThis function therefore replaces the [`library()`](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/library) function.\n\n\n::: {.callout-important}\n## Important\n\nUpdate your **DESCRIPTION** file regularly by: \n\n- adding any new packages you use\n- removing packages you no longer use\n:::\n\n\n**3) Load functions {{< fa brands r-project >}}**&nbsp; with the [`devtools::load_all()`](https://www.rdocumentation.org/packages/devtools/versions/2.4.5/topics/load_all) function\n\n\nThe [`devtools::load_all()`](https://www.rdocumentation.org/packages/devtools/versions/2.4.5/topics/load_all) function has a second advantage: it will load {{< fa brands r-project >}} functions stored in the **R/** folder and make them accessible in the session. It therefore replaces the [`source()`](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/source) function.\n\n\n{{< fa warning >}}&nbsp; After each modification to a {{< fa brands r-project >}} function, don't forget to execute the [`devtools::load_all()`](https://www.rdocumentation.org/packages/devtools/versions/2.4.5/topics/load_all) function. You can use the keyboard shortcut `Ctrl + Shift + L` in RStudio.\n\n\n{{< fa hand-point-right >}}&nbsp; Try these two functions.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Install required packages ----\ndevtools::install_deps(upgrade = \"never\")\n\n## Load packages and functions ----\ndevtools::load_all()\n```\n:::\n\n\n\n::: {.callout-tip}\n## Good practice #11\n\nWith a **DESCRIPTION** file (listing the required packages) and a **R/** folder, you can use: \n\n- [`devtools::install_deps()`](https://devtools.r-lib.org/reference/install_deps.html) to install (and update) packages: don't use `install.packages()` anymore.\n- [`devtools::load_all()`](https://www.rdocumentation.org/packages/devtools/versions/2.4.5/topics/load_all) to 1) load (and attach) packages and 2) load your {{< fa brands r-project >}} functions: no longer use `library()` or `source()` (to load your functions).\n:::\n\n\n<br/>\n\n\n\n## Main script\n\nTo automate our project, we'll create a main {{< fa brands r-project >}} script at the root of the project. By convention, we'll call it **make.R**. It will have two objectives:\n\n- **set up the project** by installing and loading packages and functions\n- **run the project** by sourcing scripts {{< fa brands r-project >}} sequentially.\n\nThe idea is that, once the project is finished, the user only executes this script: it's the **conductor** of the project. \n\n{{< fa hand-point-right >}}&nbsp; Use the [`utils::file.edit()`](https://rdrr.io/r/utils/file.edit.html) function to create a {{< fa brands r-project >}} script at the root of the project.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Create a main script ----\nutils::file.edit(here::here(\"make.R\"))\n```\n:::\n\n\n\n{{< fa hand-point-right >}}&nbsp; Add the two previous functions: \n\n::: {.small}\n\n::: {.cell}\n\n```{.r .cell-code}\n# Setup project ----\n\n## Install packages ----\ndevtools::install_deps(upgrade = \"never\")\n\n## Load packages & functions ----\ndevtools::load_all()\n```\n:::\n\n:::\n\n\n{{< fa hand-point-right >}}&nbsp; Finally, add a line to the **make.R** file that will execute the **analyses/download-data.R** script.\n\n{{< fa lightbulb >}}&nbsp; Use the [`source()`](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/source) and [`here::here()`](https://here.r-lib.org/reference/here.html) functions to do this.\n\n\n\n**Suggestion** &nbsp;{{< fa caret-down >}}\n\n::: {.small}\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# Project title\n#\n# Project description\n# ...\n#\n# Author: Jane Doe\n# Date: 2024/12/02\n\n\n# Setup project ----\n\n## Install packages ----\ndevtools::install_deps(upgrade = \"never\")\n\n## Load packages & functions ----\ndevtools::load_all()\n\n\n# Run project ----\n\n## Download raw data ----\nsource(here::here(\"analyses\", \"download-data.R\"))\n```\n:::\n\n:::\n\n\n::: {.callout-tip}\n## Good practice #12\n\nA **make.R** file placed at the root of the project makes it easy to set up the project (install and load the required packages and {{< fa brands r-project >}} functions) and run the various analyses sequentially (by sourcing {{< fa brands r-project >}} scripts which themselves call {{< fa brands r-project >}} functions). This is the **conductor** of the project.\n\n**Note:** Given the simplicity of this project, we could easily have placed the contents of the {{< fa brands r-project >}} script (**analyses/download-data.R**) in this **make.R**. The structure of a compendium is not fixed, but we recommend that you use at least {{< fa brands r-project >}} functions and a **make.R**.\n\n```{mermaid}\n%%{init:{'theme':'neutral','flowchart':{'htmlLabels':false}}}%%\nflowchart LR\n  A(\"make.R\") --> B(\"analyses/download-data.R\")\n  B --> C(\"dl_pantheria_data()\")\n```\n:::\n\n\n\n::: {.small}\n{{< fa folder >}}&nbsp; **Research compendium at the end**\n\n```\npractice/                                   # Root of the compendium\n|\n├─ practice.Rproj                           # RStudio project file\n|\n├─ README.md                                # Presentation of the project\n├─ DESCRIPTION                              # Project metadata\n├─ LICENSE.md                               # License of the project\n|\n├─ data/                                    # Contains raw data\n|  └─ pantheria/                            # PanTHERIA database\n|     └─ PanTHERIA_1-0_WR05_Aug2008.txt\n|\n├─ outputs/                                 # Contains results\n├─ figures/                                 # Contains figures\n|\n├─ R/                                       # Contains R functions (only)\n|  └─ dl_pantheria_data.R                   # Function to download PanTHERIA data\n|\n├─ analyses/                                # Contains R scripts\n|  └─ download-data.R                       # Script to download raw data\n|\n└─ make.R                                   # Script to setup & run the project\n```\n:::\n\n\n\n\n<br/>\n\n\n\n## Documentation (again)\n\nDon't forget to finalize your project documentation.\n\n{{< fa hand-point-right >}}&nbsp; Edit the **_Title_** and **_Description_** sections of the **DESCRIPTION** file.\n\n::: {.small}\n```\nPackage: practice\nType: Package\nTitle: Download PanTHERIA database\nVersion: 0.0.0.9000\nAuthors@R: c(\n    person(given   = \"Jane\",\n           family  = \"Doe\",\n           role    = c(\"aut\", \"cre\", \"cph\"),\n           email   = \"jane.doe@mail.me\",\n           comment = c(ORCID = \"0000-0000-0000-0000\")))\nDescription: This project aims to download the PanTHERIA databases. It is \n    structured as a research compendium to be reproducible.\n    This is the result of the Practice 1 of the training course Reproducible \n    Research in Computational Ecology available at:\n    <https://rdatatoolbox.github.io/chapters/ex-compendium.html>.\nLicense: GPL-3\nEncoding: UTF-8\nImports:\n    here,\n    utils\n```\n:::\n\n{{< fa hand-point-right >}}&nbsp; Finally edit the **README**:\n\n::: {.small}\n```\n# Practice\n\nThis project aims to download the [PanTHERIA](https://doi.org/10.1890/08-1494.1) \ndatabase (Jones _et al._, 2009). It is structured as a research compendium \nto be reproducible.\n\n**NB.** This is the result of the Practice 1 of the training course\n[Reproducible Research in Computational Ecology](https://rdatatoolbox.github.io).\n\n\n## Content\n\nThis project is structured as follow:\n\n.\n|\n├─ practice.Rproj                           # RStudio project file\n|\n├─ README.md                                # Presentation of the project\n├─ DESCRIPTION                              # Project metadata\n├─ LICENSE.md                               # License of the project\n|\n├─ data/                                    # Contains raw data\n|  └─ pantheria/                            # PanTHERIA database\n|     └─ PanTHERIA_1-0_WR05_Aug2008.txt\n|\n├─ outputs/                                 # Contains results\n├─ figures/                                 # Contains figures\n|\n├─ R/                                       # Contains R functions (only)\n|  └─ dl_pantheria_data.R                   # Function to download PanTHERIA data\n|\n├─ analyses/                                # Contains R scripts\n|  └─ download-data.R                       # Script to download raw data\n|\n└─ make.R                                   # Script to setup & run the project\n\n\n## Installation\n\nComing soon...\n\n\n## Usage\n\nOpen the `practice.Rproj` file in RStudio and run `source(\"make.R\")` to launch \nanalyses. \n\n- All packages will be automatically installed and loaded\n- Datasets will be saved in the `data/` directory\n\n\n## License\n\nThis project is released under the \n[GPL-3](https://choosealicense.com/licenses/gpl-3.0/) license.\n\n\n## Citation\n\n> Doe J (2024) Download PanTHERIA and WWF WildFinder databases.\n\n\n## References\n\nJone KE, Bielby J, Cardillo M _et al._ (2009) PanTHERIA: A \nspecies-level database of life history, ecology, and geography of extant and \nrecently extinct mammals. _Ecology_, 90, 2648. \nDOI: [10.1890/08-1494.1](https://doi.org/10.1890/08-1494.1)\n```\n\n:::\n\n\n<br/>\n\n> **Congratulations** {{< fa wand-sparkles >}}\n>\n> Your project is now a **functional** and **reproducible** research compendium.\n\n\n<br/>\n\n{{< fa lightbulb >}}&nbsp; The final compendium can be found [**here**](https://github.com/rdatatoolbox/practice-1).\n\n<br/>\n\n\n::: {.callout-note}\n## The [`rcompendium::new_compendium()`](https://frbcesab.github.io/rcompendium/reference/new_compendium.html) function\n\nAll these steps can be performed with a single function: \n[`new_compendium()`](https://frbcesab.github.io/rcompendium/reference/new_compendium.html) from [`rcompendium`](https://github.com/frbcesab/rcompendium). Read the documentation carefully before using this function.\n:::\n\n\n<br/>\n\n## References\n\nJones KE, Bielby J, Cardillo M _et al._ (2009) PanTHERIA: a species-level database of life history, ecology, and geography of extant and recently extinct mammals. _Ecology_, 90, 2648.\nDOI: <https://doi.org/10.1890/08-1494.1>.\n\nMarwick B, Boettiger C & Mullen L (2018) Packaging data analytical work reproducibly using R (and friends). _PeerJ_. DOI: <https://doi.org/10.7287/peerj.preprints.3192v2>.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}