{
  "hash": "f6f65622ca6d0816a39dba7c4acc5da3",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Storing secrets with the .Renviron file\"\nauthor: \"Nicolas Casajus\"\ndate: \"2024-03-12\"\ncategories: [r, secret, .renviron, security]\nimage: \"logo-r.png\"\ntoc: true\ndraft: false\n---\n\n\n## Introduction\n\nWhat is a secret? It is usually a password, an username or an API token (key) required by services. For instance, some {{< fa brands r-project >}} packages require an authentication method:\n\n- [`usethis`](https://usethis.r-lib.org/) requires a token to control the [GitHub API](https://docs.github.com/en/rest)\n- [`taxize`](https://docs.ropensci.org/taxize/) requires tokens to query API provided by several taxonomic databases\n- [`rwosstarter`](https://frbcesab.github.io/rwosstarter/) requires a token to access the [Web of Science API](https://developer.clarivate.com/apis/wos-starter)\n- [`rgbif`](https://docs.ropensci.org/rgbif/) requires an username and a password associated by a [GBIF](https://www.gbif.org/) account\n\nIt's tempting to record secrets as variables in R scripts. But keep in mind this:<br>\n**Never share your secrets with anyone** (this also includes GitHub).\n\nAccording to the [documentation of the `httr`](https://httr.r-lib.org/articles/secrets.html) package, there is three secure ways to store your secrets:\n\n- Ask for the secret each time (no permanent storage).\n- Store the secret as an environment variable.\n- Use the [`keyring`](https://keyring.r-lib.org/) package and the operating systemâ€™s credential store.\n\nHere we will see how to easily **store secret as an environment variable**.\n\n\n::: {.callout-tip}\n## Environment variable\n\nAccording to [Wikipedia](https://en.wikipedia.org/wiki/Environment_variable),\n\n> An _environment variable_ is a user-definable value that can affect the way running processes will behave on a computer.\n\nIn short, it is a way to pass information to a program. Environment variable are used by many programs and operating systems and are made up of a **name-value pair**.\n:::\n\n\n## The .Renviron file\n\nThe [{{< fa brands r-project >}} startup process](https://rstats.wtf/r-startup.html) is complex but one special {{< fa brands r-project >}} file is interesting for our purpose: the `.Renviron` file. This file does not contain {{< fa brands r-project >}} code: it only contains environment variables that will be pass to {{< fa brands r-project >}} at startup. It looks like:\n\n```txt\nNAME1=value1\nNAME2=value2\n```\n\nWe can use this file to store our secrets. To open (and create if necessary) the `.Renviron` file, run this command:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Create (if required) and open ~/.Renviron file ----\nutils::file.edit(\"~/.Renviron\")\n\n## Alternatively,\nusethis::edit_r_environ()\n```\n:::\n\n\nThis command will create an `.Renviron` file at the user level (i.e. in his/her `HOME` directory) and all environment variables defined inside will be available for all {{< fa brands r-project >}} sessions.\n\nTo store a new secret, just add a new line. For instance:\n\n```txt\nGITHUB_PAT='ghp_9999zzz9999zzz'\n```\n\n**N.B.** add a new empty line at the end of this file otherwise {{< fa brands r-project >}} will ignore it.\n\n\n## Accessing secrets\n\nTo retrieve the value of a secret (and any environment variable), just use the function [`Sys.getenv()`](https://stat.ethz.ch/R-manual/R-patched/library/base/html/Sys.getenv.html).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Get secret value ----\nSys.getenv(\"GITHUB_PAT\")\n\n## Handle this secret securely ----\ngithub_pat <- Sys.getenv(\"GITHUB_PAT\")\n```\n:::\n\n\n**N.B.** by running `Sys.getenv()` without argument you will print all available environment variables.\n\n\n## To go further\n\nA `.Renviron` file can be created at three different levels:\n\n- at the system level (named `.Renviron.site`)\n- at the user level (`~/.Renviron`)\n- at the project level (`.Renviron`)\n\nAt startup {{< fa brands r-project >}} will first read `.Renviron.site`, then `~/.Renviron` and finally the `.Renviron` of the project.\nThis means that if the same environment variable is defined in `~/.Renviron` (user level) and in the `.Renviron` of the project, the value defined in the `.Renviron` of the project will overwrite the one defined at the user level.\n\n- If you want to store a secret that be shared among projects, store it in the `~/.Renviron` (user level)\n- If you want to store a secret specific to a project, store it in the `.Renviron` (project level)\n\n\n::: {.callout-important}\n## `git` and `.Renviron`\n\nIf you create a `.Renviron` file at the project level, **do not forget** to add this file to the `.gitignore`. Otherwise your secret will be published on GitHub.\n:::\n\n\n## Resources\n\n<https://rstats.wtf/r-startup.html><br>\n<https://resources.numbat.space/using-.rprofile-and-.html><br>\n<https://cran.r-project.org/web/packages/httr/vignettes/secrets.html><br>\n<https://www.r-bloggers.com/2024/02/key-advantages-of-using-the-keyring-package/>\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}